#if 0
	shc Version 3.8.7, Generic Script Compiler
	Copyright (c) 1994-2009 Francisco Rosales <frosal@fi.upm.es>

	shc -v -r -T -f mountChecker.sh 
#endif

static  char data [] = 
#define      chk2_z	19
#define      chk2	((&data[3]))
	"\237\026\225\176\043\113\222\320\033\301\056\165\042\121\116\043"
	"\206\165\320\061\356\276"
#define      pswd_z	256
#define      pswd	((&data[44]))
	"\317\133\114\267\003\001\104\021\267\164\077\015\274\041\005\355"
	"\313\275\103\177\343\054\133\063\234\023\330\162\324\343\277\376"
	"\137\131\022\155\323\265\024\277\013\362\267\325\024\124\250\203"
	"\261\057\201\167\027\334\253\263\360\204\046\304\147\345\302\307"
	"\077\324\064\022\212\110\321\226\073\210\153\117\335\024\323\217"
	"\103\124\006\133\061\262\017\041\066\065\345\235\033\250\144\132"
	"\174\230\154\007\341\076\235\035\306\011\155\244\035\100\063\141"
	"\225\072\274\306\354\314\350\042\001\316\300\034\166\044\166\363"
	"\275\343\372\237\041\230\275\350\241\052\215\277\153\300\040\000"
	"\373\335\307\347\251\257\012\253\175\312\307\363\357\076\346\255"
	"\042\341\115\104\171\012\055\033\064\272\332\237\173\372\240\166"
	"\330\147\136\201\026\150\054\224\063\364\207\043\063\156\320\126"
	"\120\035\232\312\050\307\345\134\202\277\374\375\272\235\164\223"
	"\004\322\024\033\073\101\257\156\066\067\221\152\246\142\300\366"
	"\200\132\300\250\042\245\004\245\145\001\242\040\236\027\263\243"
	"\351\310\276\044\012\156\223\100\245\045\252\113\207\152\101\007"
	"\305\002\257\350\250\264\215\015\266\057\056\125\107\341\370\061"
	"\252\267\126\264\045\351\164\256\073\024\305\321\036\036\156\356"
	"\171\273\246\175\274\352\216\164\137\315\201\033\356\207\011\272"
	"\105\114\071\050\171\256\327\264\302\234\205\340\273"
#define      msg1_z	42
#define      msg1	((&data[347]))
	"\257\165\262\153\137\100\340\277\111\256\232\021\027\134\026\342"
	"\221\314\233\114\122\144\321\257\161\170\310\362\246\205\062\016"
	"\153\201\232\027\117\263\311\170\252\142\001\162\147\340\062\351"
	"\376\337\016\141"
#define      text_z	950
#define      text	((&data[626]))
	"\344\267\056\060\361\126\252\237\055\136\141\312\344\102\206\330"
	"\021\273\207\206\155\363\346\256\323\246\274\065\201\271\037\146"
	"\160\115\227\141\244\101\000\322\237\142\235\203\245\043\133\267"
	"\336\343\076\114\326\045\372\252\313\266\337\115\157\377\263\337"
	"\114\112\101\361\213\102\303\053\245\140\257\112\204\013\002\142"
	"\356\100\257\305\145\251\157\061\137\117\176\317\116\061\257\233"
	"\173\360\214\007\062\117\062\330\260\341\043\065\355\045\230\333"
	"\146\107\240\313\360\017\374\120\137\172\037\255\254\317\110\050"
	"\277\324\057\362\044\142\312\325\104\356\012\061\023\243\015\171"
	"\352\255\105\333\275\102\053\034\275\113\312\151\032\022\222\332"
	"\347\302\314\014\045\227\342\151\205\355\233\231\220\251\023\172"
	"\126\130\125\024\233\201\060\130\314\373\302\347\016\124\301\366"
	"\026\216\002\074\046\345\245\254\322\101\105\142\352\130\335\101"
	"\261\063\125\114\264\206\245\201\201\150\150\217\274\051\205\323"
	"\270\210\017\336\155\265\212\100\367\320\242\032\064\202\142\216"
	"\075\052\321\173\355\224\004\130\257\035\257\354\313\104\145\024"
	"\131\111\322\260\056\120\035\265\233\111\174\243\045\300\257\366"
	"\057\067\145\176\016\230\147\251\021\141\224\223\351\334\333\312"
	"\375\346\254\163\120\277\357\340\017\256\332\300\326\360\243\071"
	"\150\360\377\221\147\147\031\225\150\014\073\266\375\045\367\001"
	"\146\344\301\011\310\214\342\242\046\016\114\163\151\342\121\165"
	"\166\257\255\352\152\207\274\116\265\120\144\101\120\235\211\361"
	"\173\357\243\016\270\010\372\026\051\265\143\014\060\200\161\064"
	"\037\134\026\236\355\234\175\042\026\140\101\030\145\000\352\337"
	"\334\277\021\156\110\200\260\005\360\037\253\061\117\052\351\133"
	"\362\031\054\216\121\170\351\306\007\122\032\054\311\000\263\326"
	"\373\005\214\157\156\307\272\305\352\006\063\237\274\317\262\135"
	"\236\130\257\322\157\065\344\357\106\340\001\374\372\302\160\206"
	"\223\344\126\115\347\245\273\330\236\274\075\223\354\256\213\267"
	"\256\044\330\254\375\102\276\253\106\025\307\304\063\320\246\070"
	"\163\145\361\046\106\127\237\314\131\237\001\226\345\253\071\217"
	"\020\057\000\326\225\266\373\362\125\262\353\055\346\227\236\220"
	"\020\070\307\250\214\061\303\136\221\023\224\142\217\202\221\017"
	"\367\227\340\360\377\271\360\257\205\056\261\350\002\277\267\344"
	"\177\353\333\221\010\215\250\126\307\127\042\327\343\211\065\345"
	"\030\023\057\354\045\333\010\015\362\277\042\247\005\227\011\370"
	"\003\236\312\241\156\144\102\372\236\112\252\252\121\262\276\361"
	"\131\003\342\347\131\210\303\260\343\351\366\374\326\266\133\057"
	"\244\121\267\324\233\332\356\010\073\113\354\053\144\107\002\260"
	"\321\370\035\307\072\013\050\202\356\252\272\104\327\362\131\134"
	"\277\100\036\156\300\121\050\324\061\214\173\016\150\141\002\236"
	"\313\131\125\175\072\333\151\144\134\156\044\376\160\213\132\250"
	"\342\140\074\170\202\051\374\234\046\121\131\074\300\335\213\006"
	"\347\132\156\056\162\121\276\162\307\226\304\151\267\006\127\222"
	"\217\147\314\167\126\336\133\034\327\127\350\106\241\241\056\321"
	"\277\267\321\100\340\032\200\255\041\020\013\031\311\327\317\307"
	"\036\240\114\310\214\027\310\241\360\147\007\343\304\256\306\146"
	"\050\075\321\132\044\022\215\005\207\373\014\266\101\130\051\262"
	"\342\041\012\131\162\075\061\344\074\025\300\136\373\035\342\154"
	"\355\320\226\130\154\302\032\165\147\261\177\055\254\037\145\217"
	"\027\237\375\035\315\302\116\314\347\030\024\013\022\261\066\074"
	"\112\255\104\215\224\003\020\357\117\000\072\327\222\135\177\111"
	"\164\233\305\207\114\376\121\376\006\320\322\346\127\011\221\136"
	"\235\252\002\073\220\225\276\375\213\231\152\371\262\262\075\126"
	"\361\363\306\327\163\321\042\274\140\310\207\173\377\225\032\350"
	"\045\141\116\042\252\275\114\313\343\032\376\057\076\275\023\314"
	"\205\066\033\105\343\204\212\226\125\211\317\311\305\264\334\312"
	"\310\174\302\065\226\215\005\363\237\124\172\104\207\367\343\236"
	"\123\042\132\360\040\215\172\002\316\131\152\227\370\101\313\070"
	"\257\231\265\172\303\300\060\124\054\160\314\121\376\302\012\117"
	"\336\256\060\353\134\016\364\117\021\375\006\272\141\346\155\372"
	"\171\137\260\213\330\124\174\062\046\374\147\311\360\217\355\115"
	"\206\364\113\254\214\363\133\120\357\245\330\213\050\236\072\115"
	"\114\222\335\260\070\022\302\000\306\317\204\302\136\237\156\163"
	"\366\106\174\310\366\120\107\223\312\215\326\020\115\330\317\362"
	"\203\043\031\346\072\016\314\155\155\075\376\071\164\020\376\112"
	"\367\341\171\201\167\267\356\160\306\151\345\376\252\375\341\145"
	"\146\170\325\336\315\142\244\151\277\023\120\220\223\342\226\263"
	"\156\035\050\037\312\227\250\302\172\046\121\063\250\030\230\173"
	"\373\005\170\156\132\024\330\160\100\163\063\240\347\156\354\061"
	"\212\027\236\212\041\065\030\210\144\053\345\304\267\264\231\326"
	"\071\243\306\255\030\354\330\164\321\362\142\264\351\317\175\116"
	"\000\273\057\323\316\142\343\161\005\104\214\152\322\071\170\136"
	"\143\137\220\067\324\177\243\266\136\111\264\005\170\307\270\357"
	"\237\342\051\200\043\332\263\171\047\150\377\315\351\201\065\121"
	"\021\362\173\226\305\064\037\325\022\215\213\235\315\202\155\157"
	"\144\226\360\207\161\243\000\231\013\000\146\365\201\234\107\222"
	"\216\303\051\124\367\111\051\011\326\264\247\243\067\024\023\233"
	"\253\003\043\035\247\044\266\263\044\035\250\246\271\360\071\110"
	"\263\143\234\252\254\306\264\202\173\133\046\262\160\071\115\033"
	"\075\161\070\344\225\357\230\272\015\100\141\307\061\232\017\344"
	"\376\254\216\252\162\103\055\355\236\123\240\017\214\355\053\312"
	"\137\143\256\365\123\107\257\140\210\021\050\271\253\067\235\252"
	"\343\054\124\126\157\201\104\016\324\344\035\141\322\110\053\061"
	"\254\332\046\000\041\326\141\251\347\211\143\223\301\000\075\245"
	"\055\221\373\234\023\077\253\350\044\311\111\366\022\165\047\277"
	"\117\116\300\161\044\041\033\013\253\176\236\154\177\334\021\254"
	"\155\015\111\201\115\364\151\161\276\262"
#define      lsto_z	1
#define      lsto	((&data[1793]))
	"\037"
#define      chk1_z	22
#define      chk1	((&data[1797]))
	"\335\120\351\107\362\273\246\001\320\373\123\375\306\260\246\243"
	"\060\003\072\177\017\070\364\163\246\001\161"
#define      date_z	1
#define      date	((&data[1821]))
	"\277"
#define      tst1_z	22
#define      tst1	((&data[1826]))
	"\003\210\232\260\307\310\221\105\140\105\172\336\103\037\156\013"
	"\171\110\076\231\311\025\123\170\103\330\365\250\371"
#define      msg2_z	19
#define      msg2	((&data[1855]))
	"\340\146\254\223\117\343\317\031\154\253\351\100\127\144\165\151"
	"\110\137\267\316\007\145\061\315\175\273\135"
#define      shll_z	10
#define      shll	((&data[1878]))
	"\042\225\055\236\075\324\324\125\043\227"
#define      xecc_z	15
#define      xecc	((&data[1888]))
	"\305\073\047\141\015\236\005\237\032\135\012\172\045\323\374"
#define      tst2_z	19
#define      tst2	((&data[1903]))
	"\041\170\164\317\365\111\055\326\100\342\215\151\321\105\146\357"
	"\223\363\035\354"
#define      rlax_z	1
#define      rlax	((&data[1923]))
	"\062"
#define      opts_z	1
#define      opts	((&data[1924]))
	"\316"
#define      inlo_z	3
#define      inlo	((&data[1925]))
	"\221\221\216"/* End of data[] */;
#define      hide_z	4096
#define DEBUGEXEC	0	/* Define as 1 to debug execvp calls */
#define TRACEABLE	1	/* Define as 1 to enable ptrace the executable */

/* rtc.c */

#include <sys/stat.h>
#include <sys/types.h>

#include <errno.h>
#include <stdio.h>
#include <stdlib.h>
#include <string.h>
#include <time.h>
#include <unistd.h>

/* 'Alleged RC4' */

static unsigned char stte[256], indx, jndx, kndx;

/*
 * Reset arc4 stte. 
 */
void stte_0(void)
{
	indx = jndx = kndx = 0;
	do {
		stte[indx] = indx;
	} while (++indx);
}

/*
 * Set key. Can be used more than once. 
 */
void key(void * str, int len)
{
	unsigned char tmp, * ptr = (unsigned char *)str;
	while (len > 0) {
		do {
			tmp = stte[indx];
			kndx += tmp;
			kndx += ptr[(int)indx % len];
			stte[indx] = stte[kndx];
			stte[kndx] = tmp;
		} while (++indx);
		ptr += 256;
		len -= 256;
	}
}

/*
 * Crypt data. 
 */
void arc4(void * str, int len)
{
	unsigned char tmp, * ptr = (unsigned char *)str;
	while (len > 0) {
		indx++;
		tmp = stte[indx];
		jndx += tmp;
		stte[indx] = stte[jndx];
		stte[jndx] = tmp;
		tmp += stte[indx];
		*ptr ^= stte[tmp];
		ptr++;
		len--;
	}
}

/* End of ARC4 */

/*
 * Key with file invariants. 
 */
int key_with_file(char * file)
{
	struct stat statf[1];
	struct stat control[1];

	if (stat(file, statf) < 0)
		return -1;

	/* Turn on stable fields */
	memset(control, 0, sizeof(control));
	control->st_ino = statf->st_ino;
	control->st_dev = statf->st_dev;
	control->st_rdev = statf->st_rdev;
	control->st_uid = statf->st_uid;
	control->st_gid = statf->st_gid;
	control->st_size = statf->st_size;
	control->st_mtime = statf->st_mtime;
	control->st_ctime = statf->st_ctime;
	key(control, sizeof(control));
	return 0;
}

#if DEBUGEXEC
void debugexec(char * sh11, int argc, char ** argv)
{
	int i;
	fprintf(stderr, "shll=%s\n", sh11 ? sh11 : "<null>");
	fprintf(stderr, "argc=%d\n", argc);
	if (!argv) {
		fprintf(stderr, "argv=<null>\n");
	} else { 
		for (i = 0; i <= argc ; i++)
			fprintf(stderr, "argv[%d]=%.60s\n", i, argv[i] ? argv[i] : "<null>");
	}
}
#endif /* DEBUGEXEC */

void rmarg(char ** argv, char * arg)
{
	for (; argv && *argv && *argv != arg; argv++);
	for (; argv && *argv; argv++)
		*argv = argv[1];
}

int chkenv(int argc)
{
	char buff[512];
	unsigned long mask, m;
	int l, a, c;
	char * string;
	extern char ** environ;

	mask  = (unsigned long)&chkenv;
	mask ^= (unsigned long)getpid() * ~mask;
	sprintf(buff, "x%lx", mask);
	string = getenv(buff);
#if DEBUGEXEC
	fprintf(stderr, "getenv(%s)=%s\n", buff, string ? string : "<null>");
#endif
	l = strlen(buff);
	if (!string) {
		/* 1st */
		sprintf(&buff[l], "=%lu %d", mask, argc);
		putenv(strdup(buff));
		return 0;
	}
	c = sscanf(string, "%lu %d%c", &m, &a, buff);
	if (c == 2 && m == mask) {
		/* 3rd */
		rmarg(environ, &string[-l - 1]);
		return 1 + (argc - a);
	}
	return -1;
}

#if !TRACEABLE

#define _LINUX_SOURCE_COMPAT
#include <sys/ptrace.h>
#include <sys/types.h>
#include <sys/wait.h>
#include <fcntl.h>
#include <signal.h>
#include <stdio.h>
#include <unistd.h>

#if !defined(PTRACE_ATTACH) && defined(PT_ATTACH)
#	define PTRACE_ATTACH	PT_ATTACH
#endif
void untraceable(char * argv0)
{
	char proc[80];
	int pid, mine;

	switch(pid = fork()) {
	case  0:
		pid = getppid();
		/* For problematic SunOS ptrace */
#if defined(__FreeBSD__)
		sprintf(proc, "/proc/%d/mem", (int)pid);
#else
		sprintf(proc, "/proc/%d/as",  (int)pid);
#endif
		close(0);
		mine = !open(proc, O_RDWR|O_EXCL);
		if (!mine && errno != EBUSY)
			mine = !ptrace(PTRACE_ATTACH, pid, 0, 0);
		if (mine) {
			kill(pid, SIGCONT);
		} else {
			perror(argv0);
			kill(pid, SIGKILL);
		}
		_exit(mine);
	case -1:
		break;
	default:
		if (pid == waitpid(pid, 0, 0))
			return;
	}
	perror(argv0);
	_exit(1);
}
#endif /* !TRACEABLE */

char * xsh(int argc, char ** argv)
{
	char * scrpt;
	int ret, i, j;
	char ** varg;

	stte_0();
	 key(pswd, pswd_z);
	arc4(msg1, msg1_z);
	arc4(date, date_z);
	if (date[0] && (atoll(date)<time(NULL)))
		return msg1;
	arc4(shll, shll_z);
	arc4(inlo, inlo_z);
	arc4(xecc, xecc_z);
	arc4(lsto, lsto_z);
	arc4(tst1, tst1_z);
	 key(tst1, tst1_z);
	arc4(chk1, chk1_z);
	if ((chk1_z != tst1_z) || memcmp(tst1, chk1, tst1_z))
		return tst1;
	ret = chkenv(argc);
	arc4(msg2, msg2_z);
	if (ret < 0)
		return msg2;
	varg = (char **)calloc(argc + 10, sizeof(char *));
	if (!varg)
		return 0;
	if (ret) {
		arc4(rlax, rlax_z);
		if (!rlax[0] && key_with_file(shll))
			return shll;
		arc4(opts, opts_z);
		arc4(text, text_z);
		arc4(tst2, tst2_z);
		 key(tst2, tst2_z);
		arc4(chk2, chk2_z);
		if ((chk2_z != tst2_z) || memcmp(tst2, chk2, tst2_z))
			return tst2;
		if (text_z < hide_z) {
			/* Prepend spaces til a hide_z script size. */
			scrpt = malloc(hide_z);
			if (!scrpt)
				return 0;
			memset(scrpt, (int) ' ', hide_z);
			memcpy(&scrpt[hide_z - text_z], text, text_z);
		} else {
			scrpt = text;	/* Script text */
		}
	} else {			/* Reexecute */
		if (*xecc) {
			scrpt = malloc(512);
			if (!scrpt)
				return 0;
			sprintf(scrpt, xecc, argv[0]);
		} else {
			scrpt = argv[0];
		}
	}
	j = 0;
	varg[j++] = argv[0];		/* My own name at execution */
	if (ret && *opts)
		varg[j++] = opts;	/* Options on 1st line of code */
	if (*inlo)
		varg[j++] = inlo;	/* Option introducing inline code */
	varg[j++] = scrpt;		/* The script itself */
	if (*lsto)
		varg[j++] = lsto;	/* Option meaning last option */
	i = (ret > 1) ? ret : 0;	/* Args numbering correction */
	while (i < argc)
		varg[j++] = argv[i++];	/* Main run-time arguments */
	varg[j] = 0;			/* NULL terminated array */
#if DEBUGEXEC
	debugexec(shll, j, varg);
#endif
	execvp(shll, varg);
	return shll;
}

int main(int argc, char ** argv)
{
#if DEBUGEXEC
	debugexec("main", argc, argv);
#endif
#if !TRACEABLE
	untraceable(argv[0]);
#endif
	argv[1] = xsh(argc, argv);
	fprintf(stderr, "%s%s%s: %s\n", argv[0],
		errno ? ": " : "",
		errno ? strerror(errno) : "",
		argv[1] ? argv[1] : "<null>"
	);
	return 1;
}
